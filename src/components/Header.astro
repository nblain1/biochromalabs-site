---
import { navigation, siteData } from '../data/siteData';

const currentPath = Astro.url.pathname.replace(/\/$/, '') || '/';
const isActive = (href: string) => {
  const normalizedHref = href.replace(/\/$/, '') || '/';

  if (normalizedHref === '/') {
    return currentPath === '/';
  }

  return currentPath === normalizedHref || currentPath.startsWith(`${normalizedHref}/`);
};
---

<header class="sticky top-0 z-50 border-b border-white/10 bg-slate-950/80 backdrop-blur">
  <nav class="mx-auto flex max-w-6xl items-center justify-between px-4 py-4 sm:px-6 lg:px-8">
    <a href="/" class="flex items-center gap-3 text-white">
      <span class="flex h-10 w-10 items-center justify-center rounded-2xl bg-emerald-500/20 text-emerald-300">
        <i class="ri-flask-line text-xl"></i>
      </span>
      <span class="font-heading text-lg font-semibold">{siteData.name}</span>
    </a>

    <div class="hidden items-center gap-8 md:flex">
      {navigation.map((item) => (
        <a
          class={`text-sm font-medium transition-colors ${
            isActive(item.href)
              ? 'text-emerald-200 border-b border-emerald-300/70 pb-1'
              : 'text-slate-200 hover:text-emerald-200'
          }`}
          href={item.href}
          aria-current={isActive(item.href) ? 'page' : undefined}
        >
          {item.name}
        </a>
      ))}
      <a class="btn-primary" href="/contact">
        Start a project
        <i class="ri-arrow-right-up-line"></i>
      </a>
    </div>

    <button
      id="mobile-menu-button"
      class="md:hidden text-white p-2 flex items-center justify-center"
      aria-label="Toggle menu"
      aria-expanded="false"
    >
      <i id="menu-icon" class="ri-menu-line text-2xl"></i>
      <i id="close-icon" class="ri-close-line text-2xl hidden"></i>
    </button>
  </nav>

  <div id="mobile-menu" class="hidden border-t border-white/10 bg-slate-950/95 px-4 py-4 md:hidden">
    <div class="flex flex-col gap-3">
      {navigation.map((item) => (
        <a
          class={`rounded-xl px-3 py-2 text-sm font-medium transition-colors ${
            isActive(item.href)
              ? 'bg-emerald-500/15 text-emerald-200 border border-emerald-400/30'
              : 'text-slate-200 hover:bg-white/5'
          }`}
          href={item.href}
          aria-current={isActive(item.href) ? 'page' : undefined}
        >
          {item.name}
        </a>
      ))}
      <a class="btn-primary mt-2" href="/contact">
        Start a project
        <i class="ri-arrow-right-up-line"></i>
      </a>
    </div>
  </div>
</header>

<script>
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');

  mobileMenuButton?.addEventListener('click', () => {
    const isOpen = !mobileMenu?.classList.contains('hidden');
    mobileMenu?.classList.toggle('hidden');
    menuIcon?.classList.toggle('hidden');
    closeIcon?.classList.toggle('hidden');
    mobileMenuButton?.setAttribute('aria-expanded', String(!isOpen));
  });
</script>
