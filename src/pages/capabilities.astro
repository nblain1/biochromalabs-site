---
import Layout from '../layouts/Layout.astro';
import { siteData } from '../data/siteData';

const capabilityLayers = [
  {
    id: 'analytical-chemistry',
    title: 'Analytical Chemistry',
    summary: 'Verification of product specifications, identity, and purity for raw materials and finished goods.',
    icon: 'ri-test-tube-line',
    highlights: ['Label Claim Verification', 'Purity & Impurities', 'Compositional Analysis'],
    chapterTitle: 'Testing Applications',
    details: [
      'Label Claims & Potency: Quantitative analysis of active ingredients, vitamins, and minerals using HPLC/UPLC and Spectrophotometry to ensure label accuracy.',
      'Purity & Impurities: Screening for residual solvents and degradation products via GCMS and LCMS to meet strict regulatory purity standards.',
      'Compositional Analysis: Detailed profiling of proteins (Protein Analyzer), fats, and moisture for nutritional labeling and formulation consistency.',
      'Identification: Authenticity testing of raw materials using FTIR and Ion Chromatography (IC) to verify specification conformance.'
    ],
  },
  {
    id: 'microbiology-programs',
    title: 'Microbiology Programs',
    summary: 'Testing protocols designed to ensure product safety, microbiological stability, and facility hygiene.',
    icon: 'ri-bug-line',
    highlights: ['Safety Screening', 'Preservative Efficacy', 'Bacterial Challenge'],
    chapterTitle: 'Operational Safety',
    details: [
      'Pathogen Detection: Screening for S. aureus, Salmonella, E. coli, and P. aeruginosa (USP <61>/<62>) to prevent consumer health risks.',
      'Antimicrobial Efficacy: Preservative challenge testing (USP <51>) using specialized incubation suites to verify formula robustness.',
      'Specialized Studies: Bacterial Challenge and In vitro Time-Kill studies to demonstrate specific antimicrobial performance.',
      'Water & Environment: Comprehensive water suitability and environmental monitoring to maintain controlled manufacturing environments.'
    ],
  },
  {
    id: 'stability-testing',
    title: 'Stability Testing',
    summary: 'Data-driven shelf life studies to ensure product integrity remains intact from warehouse to consumer.',
    icon: 'ri-timer-line',
    highlights: ['Shelf Life Projection', 'Accelerated Aging', 'Photostability'],
    chapterTitle: 'Compliance Milestones',
    details: [
      'Shelf Life Verification: Real-time and accelerated studies in validated chambers to support expiry dating for regulatory filings.',
      'Environmental Stress: Photostability (ICH Q1B) and humidity testing to assess product resilience against light and climate fluctuations.',
      'Degradation Pathways: Forced degradation studies to identify potential breakdown triggers and ensure long-term formula stability.',
      'Packaging Compatibility: Analysis of potential container-product interactions over the intended storage duration.'
    ],
  },
  {
    id: 'method-development',
    title: 'Method Development',
    summary: 'Custom analytical protocols built for your specific matrix and regulatory pathway.',
    icon: 'ri-flask-line',
    highlights: ['Custom Protocol Design', 'Technology Transfer', 'Validation Packages'],
    chapterTitle: 'Research & Strategy',
    details: [
      'Matrix Optimization: Designing robust testing pathways for complex or novel matrices where compendial methods require modification.',
      'Regulatory Validation: Providing formal validation packages (USP <1225> / ICH Q2) required for FDA or international filings.',
      'Tech Transfer: Comprehensive documentation and SOPs to ensure seamless method adoption by your manufacturing or internal lab sites.',
      'Technical Support: Root cause analysis and troubleshooting for production deviations or unexpected analytical results.'
    ],
  }
];

const instrumentRegistry = [
  { category: "Chromatography", tools: ["UPLC / HPLC (PDA, RI, ELSD)", "Ion Chromatography (IC)", "Gas Chromatography (GC / GCMS)"] },
  { category: "Mass Spectrometry", tools: ["LCMS (Liquid / Mass Spec)", "GCMS (Gas / Mass Spec)"] },
  { category: "Spectroscopy", tools: ["FTIR (Fourier Transform Infrared)", "UV-Vis Spectrophotometry"] },
  { category: "Specialized Analysis", tools: ["Protein Analyzer (Kjeldahl/Dumas)", "Stability Chambers (Zone I-IV)", "Class II Biosafety Enclosures"] }
];
---

<Layout
  title={`Capabilities - ${siteData.name}`}
  description="Comprehensive analytical testing outcomes including purity, label claim verification, and full instrument registry."
>
  <section class="home-hero">
    <div class="home-shell">
      <nav class="breadcrumb" aria-label="Breadcrumb">
        <a href="/">Home</a>
        <span aria-hidden="true">&gt;</span>
        <span class="text-emerald-400 opacity-80">Capabilities</span>
      </nav>

      <div class="hero-grid mb-16">
        <div class="hero-copy">
          <p class="hero-eyebrow">Service Capabilities</p>
          <h1>Outcome-driven testing for regulated programs.</h1>
          <p class="hero-lead">
            From raw material verification to complete stability lifecycle management, we provide the defensible analytical data required to confidently bring your products to market.
          </p>
        </div>

        <div class="hero-media-frame">
          <img src="https://images.unsplash.com/photo-1581093588401-fbb62a02f120?w=800&q=80" alt="High Performance Liquid Chromatography (HPLC) instrumentation at BioChroma Labs" />
          <div class="hero-media-caption">
            <p>Analytical Precision</p>
            <span>Traceable, compendial methodologies.</span>
          </div>
        </div>
      </div>

      <div class="layer-grid grid-4-stack">
        {capabilityLayers.map((capability) => (
          <a href={`#${capability.id}`} class="layer-card group">
            <div class="layer-head">
              <span class="layer-icon"><i class={capability.icon}></i></span>
              <h2 class="group-hover:text-emerald-400 transition-colors">{capability.title}</h2>
            </div>
            <p class="layer-summary">{capability.summary}</p>
            <ul class="capability-pills mt-auto">
              {capability.highlights.map((item) => (
                <li>{item}</li>
              ))}
            </ul>
          </a>
        ))}
      </div>
    </div>
  </section>

  <section class="home-section chapter-section">
    <div class="home-shell">
      <div class="section-heading">
        <p>Deep Dive</p>
        <h2>Technical Applications & Methodologies</h2>
      </div>

      <div class="chapter-stack">
        {capabilityLayers.map((capability) => (
          <details id={capability.id} class="chapter-item group">
            <summary class="hover:bg-white/5 transition-colors rounded-t-lg">
              <div class="summary-content">
                <strong>{capability.title}</strong>
                <span class="chapter-subtitle block mt-1">{capability.chapterTitle}</span>
              </div>
              <i class="ri-add-line toggle-icon"></i>
            </summary>
            <div class="details-content">
              <ul class="aligned-list">
                {capability.details.map((detail) => {
                  const [label, ...textParts] = detail.split(': ');
                  return (
                    <li class="aligned-item">
                      <span class="item-label text-white font-bold">{label}:</span>
                      <span class="item-text text-slate-300">{textParts.join(': ')}</span>
                    </li>
                  );
                })}
              </ul>
            </div>
          </details>
        ))}
      </div>
    </div>
  </section>

  <section class="home-section instrument-registry-section bg-white/5 border-t border-white/10">
    <div class="home-shell">
      <div class="section-heading">
        <p>Infrastructure</p>
        <h2>Full Analytical Instrumentation Registry</h2>
      </div>

      <div class="registry-grid">
        {instrumentRegistry.map(item => (
          <div class="registry-category">
            <h4>{item.category}</h4>
            <ul>
              {item.tools.map(tool => <li>{tool}</li>)}
            </ul>
          </div>
        ))}
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Capability Specific Local Styles (Trimmed to utilize global.css where possible) */
  
  .layer-summary { font-size: 0.875rem; color: rgba(255, 255, 255, 0.6); line-height: 1.5; margin-bottom: 1.5rem; }

  /* Centered Pills */
  .capability-pills { list-style: none; padding: 0; display: flex; flex-wrap: wrap; gap: 0.5rem; }
  .capability-pills li { 
    font-size: 0.7rem; background: rgba(36, 199, 143, 0.05); color: var(--color-primary); 
    border: 1px solid rgba(36, 199, 143, 0.2); padding: 0.35rem 0.75rem; border-radius: 999px;
    display: flex; align-items: center; justify-content: center; text-align: center;
  }

  /* Deep Dive Accordions & Alignment List */
  .chapter-stack { display: flex; flex-direction: column; gap: 1rem; max-width: 1000px; margin-top: 2rem; }
  .chapter-item { background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 8px; overflow: hidden; transition: border-color 0.3s ease; }
  .chapter-item summary { padding: 1.5rem 2rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center; list-style: none; user-select: none; }
  .chapter-item summary::-webkit-details-marker { display: none; }
  .chapter-subtitle { font-size: 0.75rem; color: var(--color-primary); text-transform: uppercase; letter-spacing: 0.05em; }
  .toggle-icon { font-size: 1.5rem; color: rgba(255, 255, 255, 0.2); transition: 0.3s; }
  
  .chapter-item[open] { border-color: rgba(36, 199, 143, 0.4); }
  .chapter-item[open] .toggle-icon { transform: rotate(45deg); color: var(--color-primary); }

  /* FIXED ALIGNMENT LIST */
  .details-content { padding: 0 2rem 2rem 2rem; border-top: 1px solid rgba(255, 255, 255, 0.05); padding-top: 2rem; }
  .aligned-list { list-style: none; padding: 0; display: flex; flex-direction: column; gap: 1.5rem; }
  .aligned-item { display: flex; flex-direction: column; gap: 0.25rem; }

  @media (min-width: 768px) {
    .aligned-item { flex-direction: row; gap: 1.5rem; }
    .item-label { min-width: 240px; flex-shrink: 0; }
  }

  /* Registry Grid */
  .registry-grid { 
    display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); 
    gap: 3rem; margin-top: 3rem; padding: 3rem; background: rgba(255, 255, 255, 0.02); 
    border-radius: 12px; border: 1px solid rgba(255,255,255,0.05);
  }
  .registry-category h4 { 
    color: var(--color-primary); margin-bottom: 1.25rem; border-bottom: 1px solid rgba(36, 199, 143, 0.2); 
    padding-bottom: 0.5rem; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 0.05em;
  }
  .registry-category ul { list-style: none; padding: 0; }
  .registry-category li { font-size: 0.85rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.75rem; }
</style>

<script>
  // Ensure only one accordion is open at a time
  document.addEventListener('DOMContentLoaded', () => {
    const details = document.querySelectorAll('.chapter-item');
    details.forEach((targetDetail) => {
      targetDetail.addEventListener('click', () => {
        details.forEach((detail) => {
          if (detail !== targetDetail) { detail.removeAttribute('open'); }
        });
      });
    });
  });
</script>